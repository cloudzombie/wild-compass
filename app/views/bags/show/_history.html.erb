<div class="row">
  <div class="col-lg-6">
    <div class="box box-solid box-danger">

      <div class="box-header">
        <%= fa_icon 'flask' %><h3 class="box-title">History</h3>
      </div>

      <div class="box-body">
        <table class="table table-hover">
        <div role="tabpanel"></div>
          <tr>
            <td>Source : </td>
            <td>Target : </td>
            <td>Quantity : </td>
            <td>Timestamp : </td>
            <td>User : </td>
          </tr>
          <div class="nav nav-pills" role="pilllist">
            <tr>
              <td>
                <% if bag.lot.present? %>
                <a href="#id<%= bag.lot.id %>"
                   aria-controls="id<%= bag.lot.id %>"
                   role="tab"
                   data-toggle="tab"><%= bag.lot %></a>
                <% end %>
              </td>
              <td><%= bag %></td>
              <td><%= bag.initial_weight %></td>
              <td><%= bag.created_at.to_s :short %></td>
              <td><!--<%# bag.history.history_lines.first.user %>--></td>
            </tr>
            <% bag.history.history_lines.each do |line| %>
            <% next if line.target == bag.lot %>
              <tr>
                <td><%= bag %></td>
                <td><a href="#<%= line.id %>" aria-controls="<%= line.id %>" role="tab" data-toggle="tab"><%= line.target %></a></td>
                <td><%= line.quantity %></td>
                <td><%= line.created_at.to_s :short %></td>
                <td><!--<%#  line.user %>--></td>
              </tr>
            <% end %>
          </div>
        </table>
      </div> 
    </div>
  </div>
  
  <div class="col-lg-6">
    <div class="box box-solid box-success">
      <div class="box-header">
        <i class="fa fa-leaf"></i>
        <h3 class="box-title">Timeline</h3>
      </div>
      <div class="box-body">
        <table class="table table-hover">
          <tr>
            <th>Name : </th>
            <th>Timestamp : </th>
            <th>Event : </th>
          </tr>

          <% ordered_by_id(bag.container.try(:plants)).each do |plant| %>
          <tr>
            <td><%= link_to "#{plant}".html_safe, plant, class: "btn-sm btn-flat btn-success" %></td>
            <td><%= date_for plant.try(:created_at) if plant.present? %></td>
            <td><%= plant %> harvested to <%= bag.container %></td>
          </tr>
          <% end %>
          
          <tr>
            <td><%= link_to "#{bag.lot}".html_safe, bag.lot, class: "btn-sm btn-flat btn-info" %></td>
            <td><%= date_for bag.lot.try(:created_at) if bag.lot.present? %></td>
            <td>creation of <%= bag.lot %></td>
          </tr>

          <tr>
            <td><%= link_to "#{bag.container}".html_safe, bag.container, class: "btn-sm btn-flat btn-info" %></td>
            <td><%= date_for bag.container.try(:created_at) if bag.container.present? %></td>
            <td>creation of <%= bag.container %></td>
          </tr>

          <% ordered_by_id(bag.try(:jars)).each do |jar| %>
            <tr>
              <td><%= link_to "#{jar}".html_safe, jar, class: "btn-sm btn-flat btn-danger" %></td>
              <td><%= date_for jar.try(:created_at) if jar.present? %></td>
              <td><%= jar.current_weight %>g to <%= jar %></td>
            </tr>
          <% end %>
        </table>
      </div>
    </div>
  </div>
</div>