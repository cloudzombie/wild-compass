<div class="box box-solid box-default">
  <div class="box-header">
    <%= fa_icon 'bars' %><h3 class="box-title">History</h3>
  </div>
  <div class="box-body">
    <table class="table table-hover">
      <tr>
        <th>Source : </th>
        <th>Target : </th>
        <th>Quantity : </th>
        <th>Timestamp : </th>
        <th>User : </th>
      </tr>
      <tr>
        <td><%= described.try(:lot).nil? ? 'Plants' : described.try(:lot)  %></td>
        <td><%= described if described.present? %></td>
        <td><%= described.try(:initial_weight) %> g</td>
        <td><%= date_for described.try(:created_at) %></td>
        <td><%= (described.try(:history).try(:history_lines) || []).try(:first).try(:user) %></td>
      </tr>
      <% (described.try(:history).try(:history_lines) || []).each do |line| %>
      <% next if line.try(:target).nil? || line.try(:source).nil? %>
        <tr>
          <td><%= described if described.present? %></td>
          <td><%= line.try(:target) %></td>
          <td><%= line.try(:quantity) %> g</td>
          <td><%= date_for line.try(:created_at) %></td>
          <td><%= line.try(:user) %></td>
        </tr>
        <% end %>
      </div>
    </table>
  </div> 
</div>
