<div class="row">
  <div class="col-lg-6">
    <div class="box box-solid box-danger">
      <div class="box-header">
        <%= fa_icon 'flask' %><h3 class="box-title">History</h3>
      </div>

      <div class="box-body">
        <table class="table table-hover">
        <div role="tabpanel"></div>
          <tr>
            <td>Source : </td>
            <td>Target : </td>
            <td>Quantity : </td>
            <td>Timestamp : </td>
            <td>User : </td>
          </tr>
          <div class="nav nav-pills" role="pilllist">
            <tr>
              <td>

                <% if container.try(:lot).present? %>
                <a href="#id<%= container.try(:lot).try(:id) %>"
                   aria-controls="id<%= container.try(:lot).try(:id) %>"
                   role="tab"
                   data-toggle="tab"><%= container.try(:lot) %></a>
                <% end %>
              </td>
              <td><%= container if container.present? %></td>
              <td><%= container.try(:initial_weight) %></td>
              <td><%= date_for container.try(:created_at) %></td>
              <td><%= (container.try(:history).try(:history_lines) || []).try(:first).try(:user) %></td>
            </tr>
            <% (container.try(:history).try(:history_lines) || []).each do |line| %>
            <% next if line.try(:target) == container.try(:lot) %>
              <tr>
                <td><%= container if container.present? %></td>
                <td>
                  <a href="#<%= line.try(:id) %>"
                     aria-controls="<%= line.try(:id) %>"
                     role="tab"
                     data-toggle="tab"><%= line.try(:target) %></a>
                </td>
                <td><%= line.try(:quantity) %></td>
                <td><%= date_for line.try(:created_at) %></td>
                <td><%= line.try(:user) %></td>
              </tr>
            <% end %>
          </div>
        </table>
      </div> 
    </div>
  </div>

  <div class="col-lg-6">
    <div class="box box-solid box-danger">
      <div class="box-header">
        <i class="fa fa-flask"></i>
        <h3 class="box-title">History</h3>
      </div>
      <div class="box-body">
        <div class="tab-content">
          <% if container.try(:lot).present? %>
          <div role="tabpanel" class="tab-pane fade" id="id<%= container.try(:lot).try(:id) %>"></div>
          <% end %>
          <% (container.try(:history).try(:history_lines) || []).each do |line| %>
            <div role="tabpanel" class="tab-pane fade" id="<%= line.try(:id) %>">
              <table class="table table-hover">
                <div role="tabpanel">
                  <% next if line.try(:target).nil? %>
                  <tr>
                    <% (line.try(:target).try(:history).try(:history_lines) || []).each do |subline| %>
                    <td><%= subline.try(:source) %></td>
                    <td><%= subline.try(:target) %></td>
                    <td><%= weight_for subline.try(:quantity) %></td>
                    <td><%= date_for subline.try(:created_at) %></td>
                    <% end %>
                  </tr>
                </div>
              </table>
            </div>
        </div>
        <% end %>
      </div>
    </div>
  </div>
</div>